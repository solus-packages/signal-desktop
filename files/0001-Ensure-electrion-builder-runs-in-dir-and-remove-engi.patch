From 7397644baac1ea03729ed5e5a4581c3255249dfe Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Wed, 15 Sep 2021 19:07:02 +0300
Subject: [PATCH 1/1] Ensure electrion-builder runs in dir and remove engine
 check.

---
 package.json | 67 ++--------------------------------------------------
 1 file changed, 2 insertions(+), 65 deletions(-)

diff --git a/package.json b/package.json
index 135999e41..b471d48f2 100644
--- a/package.json
+++ b/package.json
@@ -61,7 +61,7 @@
     "build:webpack:sql-worker": "cross-env NODE_ENV=production webpack -c webpack-sql-worker.config.ts",
     "build:webpack:heic-worker": "cross-env NODE_ENV=production webpack -c webpack-heic-worker.config.ts",
     "build:electron": "electron-builder --config.extraMetadata.environment=$SIGNAL_ENV",
-    "build:release": "cross-env SIGNAL_ENV=production yarn build:electron -- --config.directories.output=release",
+    "build:release": "electron-builder -- --config.extraMetadata.environment=$SIGNAL_ENV --dir",
     "build:fuses": "node scripts/fuse-electron.js",
     "build:zip": "node scripts/zip-macos-release.js",
     "preverify:ts": "yarn build:typed-scss",
@@ -295,62 +295,8 @@
     "read-last-lines/mz/thenify-all/thenify": "3.3.1",
     "sharp/color/color-string": "1.5.5"
   },
-  "engines": {
-    "node": "14.16.0"
-  },
   "build": {
     "appId": "org.whispersystems.signal-desktop",
-    "mac": {
-      "asarUnpack": [
-        "**/*.node",
-        "node_modules/zkgroup/libzkgroup.*",
-        "node_modules/@signalapp/signal-client/build/*.node",
-        "node_modules/mac-screen-capture-permissions/build/Release/*.node"
-      ],
-      "artifactName": "${name}-mac-${version}.${ext}",
-      "category": "public.app-category.social-networking",
-      "darkModeSupport": true,
-      "hardenedRuntime": true,
-      "entitlements": "./build/entitlements.mac.plist",
-      "icon": "build/icons/mac/icon.icns",
-      "publish": [
-        {
-          "provider": "generic",
-          "url": "https://updates.signal.org/desktop"
-        }
-      ],
-      "target": [
-        "zip",
-        "dmg"
-      ],
-      "bundleVersion": "1"
-    },
-    "win": {
-      "asarUnpack": [
-        "**/*.node",
-        "node_modules/spellchecker/vendor/hunspell_dictionaries",
-        "node_modules/sharp",
-        "node_modules/zkgroup/libzkgroup.*",
-        "node_modules/@signalapp/signal-client/build/*.node"
-      ],
-      "artifactName": "${name}-win-${version}.${ext}",
-      "certificateSubjectName": "Signal Messenger, LLC",
-      "certificateSha1": "8C9A0B5C852EC703D83EF7BFBCEB54B796073759",
-      "signingHashAlgorithms": [
-        "sha256"
-      ],
-      "publisherName": "Signal Messenger, LLC",
-      "icon": "build/icons/win/icon.ico",
-      "publish": [
-        {
-          "provider": "generic",
-          "url": "https://updates.signal.org/desktop"
-        }
-      ],
-      "target": [
-        "nsis"
-      ]
-    },
     "nsis": {
       "deleteAppDataOnUninstall": true
     },
@@ -367,19 +313,10 @@
         "node_modules/@signalapp/signal-client/build/*.node"
       ],
       "target": [
-        "deb"
+        "dir"
       ],
       "icon": "build/icons/png"
     },
-    "deb": {
-      "depends": [
-        "libnotify4",
-        "libxtst6",
-        "libnss3",
-        "libasound2",
-        "libxss1"
-      ]
-    },
     "protocols": {
       "name": "sgnl-url-scheme",
       "schemes": [
-- 
2.32.0

